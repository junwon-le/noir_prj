<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.noir.review">
	
	<insert id="insertReview" parameterType="kr.co.noir.review.WriteReviewDTO">
    INSERT INTO review(review_num,room_res_num, member_num, review_star, review_title, review_msg, review_date)
    VALUES (review_seq.nextval, #{roomResNum}, #{memberNum}, #{reviewStar}, #{reviewTitle}, #{reviewMsg}, sysdate)
</insert>

<insert id="insertReviewImg" parameterType="kr.co.noir.review.WriteReviewDTO">
    INSERT INTO review_img(review_num, review_img1)
    VALUES (review_seq.currval, #{reviewImg1})
</insert>

	<select id="getUnreviewedRooms" parameterType="int" resultType="kr.co.noir.review.WriteReviewDTO">
    SELECT 
        res.room_res_num AS roomResNum,
        info.room_type   AS roomType
    FROM room_res res
    JOIN reserve rsv ON res.reserve_num = rsv.reserve_num
    JOIN room_info info ON res.room_type_num = info.room_type_num
    LEFT OUTER JOIN review rev ON res.room_res_num = rev.room_res_num
    WHERE rsv.member_num = #{memberNum}
      AND rev.review_num IS NULL
</select>

</mapper>