<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>NOIR - Find Password</title>

<link rel="stylesheet" type="text/css" href="../common/css/homepage/base.css">
<link rel="stylesheet" type="text/css" href="../common/css/homepage/style.css?v=0312">
<link rel="stylesheet" type="text/css" href="../common/css/homepage/sub.css?v=0312">
<link rel="stylesheet" type="text/css" href="../common/css/homepage/admin_style.css">

<script src="../common/js/comm/jquery-3.5.1.min.js"></script>
<script src="../common/js/comm/jquery.bxslider.js"></script>
<script src="../common/js/homepage/jquery.rwdImageMaps.min.js"></script>
<script src="../common/js/homepage/jquery.accessibility.modal.js"></script>
<script src="../common/js/comm/jquery.cookie.js"></script>
<script src="../common/js/homepage/plugin.js"></script>
<script type="text/javascript" src="../common/js/homepage/jquery.simpleWeather.js"></script>
<script src="../common/js/homepage/custom.js"></script>

<style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans KR', sans-serif; }
    body {
        background: #0f1218;
        background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('../images/hotel_bg.jpg') no-repeat center center/cover;
        min-height: 100vh; overflow-y: auto; display: flex; flex-direction: column; position: relative;
    }
    header { position: absolute; top: 0; left: 0; width: 100%; z-index: 100; }
    footer { position: relative; width: 100%; z-index: 100; }
    #privacy-layer { position: absolute; bottom: 0; width: 100%; z-index: 101; }
    #main-wrapper {
        min-height: calc(100vh - 135px); display: flex; justify-content: center; align-items: center;
        width: 100%; position: relative; z-index: 10; padding: 140px 20px 80px 20px;
    }
    .find-container { width: 100%; max-width: 450px; }
    .find-box {
        background: rgba(44, 41, 38, 0.95); padding: 40px; border-radius: 15px;
        border: 1px solid #7c6a52; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px); color: #fff; text-align: center;
    }
    .find-title { font-size: 24px; font-weight: 700; margin-bottom: 30px; letter-spacing: 2px; color: #C4A16F; }
    .input-group { margin-bottom: 15px; text-align: left; }
    input[type="text"], input[type="email"] {
        padding: 10px 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid #5a4d3b;
        border-radius: 4px; color: #fff; font-size: 14px; outline: none; transition: 0.3s; width: 100%; height: 42px;
    }
    input:focus { border-color: #C4A16F; background: rgba(196, 161, 111, 0.1); }
    #auth-area { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(124, 106, 82, 0.3); }
    .flex-group { display: flex; gap: 8px; }
    .btn-small {
        width: 80px; height: 42px; background: #5a4d3b; border: 1px solid #7c6a52; color: #d7c4a5;
        border-radius: 4px; cursor: pointer; font-size: 13px; transition: 0.3s;
    }
    .btn-small:hover { background: #C4A16F; color: #fff; }
    .submit-btn {
        width: 100%; padding: 12px; background: #C4A16F; border: none; border-radius: 4px;
        color: #fff; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px;
    }
    .submit-btn:disabled { background: #444; color: #888; cursor: not-allowed; }
    .submit-btn:hover:not(:disabled) { background: #7c6a52; }
    .link-group { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 25px; font-size: 13px; }
    .link-group a { color: #D7c4a5; text-decoration: none; transition: 0.3s; }
    .link-group a:hover { color: #C4A16F; }
    .divider { color: #7c6a52; }
</style>

<script>
$(document).ready(function(){
    
    // 인증번호 발송 버튼 클릭
    $("#btnSendCode").click(function(){
        let userId = $("#userId").val();
        let userName = $("#userName").val();
        let userEmail = $("#userEmail").val();

        if(!userId || !userName || !userEmail) {
            alert("모든 정보를 입력해주세요.");
            return;
        }

        let $btn = $(this);
        $btn.prop("disabled", true).text("전송 중...");

        $.ajax({
            // [변경] JSP -> Controller URL
            url: "/member/sendAuthCode", 
            type: "POST",
            data: { userId: userId, userName: userName, userEmail: userEmail },
            success: function(res) {
                // Controller에서 문자열로 리턴하므로 trim() 처리
                let result = res.trim();
                
                if(result === "OK") {
                    alert("인증번호가 이메일로 발송되었습니다.");
                    $("#auth-area").slideDown();
                    $btn.text("인증번호 재전송").prop("disabled", false);
                } else if(result === "NO_USER") {
                    alert("일치하는 회원 정보가 없습니다.");
                    $btn.text("인증번호 받기").prop("disabled", false);
                } else {
                    alert("메일 발송 실패. 관리자에게 문의하세요.");
                    $btn.text("인증번호 받기").prop("disabled", false);
                }
            },
            error: function() {
                alert("서버 통신 오류");
                $btn.text("인증번호 받기").prop("disabled", false);
            }
        });
    });

    $("#authCode").on("keyup", function(key){
        if(key.keyCode == 13) $("#btnVerify").click();
    });

    // 인증번호 확인 버튼 클릭
    $("#btnVerify").click(function(){
        let code = $("#authCode").val();
        if(code.length < 6) {
            alert("인증번호 6자리를 입력하세요.");
            return;
        }

        $.ajax({
            // [변경] JSP -> Controller URL
            url: "/member/verifyAuthCode", 
            type: "POST",
            data: { authCode: code },
            success: function(res) {
                if(res.trim() === "OK") {
                    alert("인증되었습니다. 비밀번호 변경 페이지로 이동합니다.");
                    location.href = "resetPw.jsp"; // 혹은 변경 페이지 URL
                } else {
                    alert("인증번호가 일치하지 않습니다.");
                }
            }
        });
    });
});
</script>
</head>

<body>
    <header>
        <div th:replace="~{fragments/header :: header}"></div>
    </header>

<div id="main-wrapper">
    <div class="find-container">
        <div class="find-box">
            <h2 class="find-title">FIND PW</h2>
            
            <div id="step1">
                <div class="input-group"><input type="text" id="userId" placeholder="아이디" required></div>
                <div class="input-group"><input type="text" id="userName" placeholder="이름" required></div>
                <div class="input-group"><input type="email" id="userEmail" placeholder="이메일" required></div>
                
                <button type="button" class="submit-btn" id="btnSendCode">인증번호 받기</button>
            </div>
            
            <div id="auth-area">
                <p style="font-size:13px; color:#C4A16F; margin-bottom:10px;">이메일로 전송된 6자리 코드를 입력하세요.</p>
                <div class="input-group flex-group">
                    <input type="text" id="authCode" placeholder="인증번호 6자리" maxlength="6">
                    <button type="button" class="btn-small" id="btnVerify">확인</button>
                </div>
            </div>

            <div class="link-group">
                <a href="login.html">로그인</a><span class="divider">|</span>
                <a href="findId.jsp">아이디 찾기</a><span class="divider">|</span>
                <a href="join.html">회원가입</a>
            </div>
        </div>
    </div>
</div>

    <footer>
        <div th:replace="~{fragments/footer :: footer}"></div>
    </footer>
    <div id="privacy-layer">
        <div th:replace="~{fragments/privacy :: privacy}"></div>
    </div>
</body>
</html>