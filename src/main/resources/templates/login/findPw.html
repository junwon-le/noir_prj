<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>NOIR - Find Password</title>
    <link rel="stylesheet" type="text/css" th:href="@{/common/css/homepage/base.css}">
    <script th:src="@{/common/js/comm/jquery-3.5.1.min.js}"></script>
    <style>
        /* 기존 블랙톤 스타일 테마 적용 */
        body { background: #0f1218; color: #fff; font-family: 'Noto Sans KR', sans-serif; }
        .find-box { 
            background: rgba(44, 41, 38, 0.95); padding: 40px; border-radius: 15px; 
            border: 1px solid #7c6a52; text-align: center; max-width: 450px; margin: 100px auto;
        }
        .find-title { color: #C4A16F; font-size: 24px; margin-bottom: 30px; letter-spacing: 2px; }
        .input-group { margin-bottom: 15px; }
        input[type="text"], input[type="email"] { 
            width: 100%; height: 42px; background: rgba(255, 255, 255, 0.05); 
            border: 1px solid #5a4d3b; color: #fff; padding: 10px; border-radius: 4px;
        }
        .submit-btn { 
            width: 100%; padding: 12px; background: #C4A16F; border: none; 
            color: #fff; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        #auth-area { display: none; margin-top: 20px; border-top: 1px solid #5a4d3b; padding-top: 20px; }
        .flex-group { display: flex; gap: 8px; }
        .btn-small { background: #5a4d3b; color: #d7c4a5; border: 1px solid #7c6a52; padding: 0 15px; cursor: pointer; }
    </style>
</head>
<body>
    <header th:replace="~{fragments/header :: header}"></header>

    <div class="find-box">
        <h2 class="find-title">FIND PASSWORD</h2>
        <div id="step1">
            <div class="input-group"><input type="text" id="userId" placeholder="아이디"></div>
            <div class="input-group"><input type="text" id="userName" placeholder="이름"></div>
            <div class="input-group"><input type="email" id="userEmail" placeholder="이메일"></div>
            <button type="button" class="submit-btn" id="btnSendCode">인증번호 받기</button>
        </div>

        <div id="auth-area">
            <p style="font-size:13px; color:#C4A16F; margin-bottom:10px;">이메일로 전송된 6자리 코드를 입력하세요.</p>
            <div class="input-group flex-group">
                <input type="text" id="authCode" placeholder="인증번호 6자리" maxlength="6">
                <button type="button" class="btn-small" id="btnVerify">확인</button>
            </div>
        </div>
    </div>

    <script>
    $(document).ready(function(){
        // 1. 인증번호 발송
        $("#btnSendCode").click(function(){
            let data = { userId: $("#userId").val(), userName: $("#userName").val(), userEmail: $("#userEmail").val() };
            if(!data.userId || !data.userName || !data.userEmail) return alert("정보를 모두 입력해주세요.");

            $(this).prop("disabled", true).text("전송 중...");
            $.post("/member/sendAuthCode", data, function(res) {
                if(res.trim() === "OK") {
                    alert("인증번호가 발송되었습니다.");
                    $("#auth-area").slideDown();
                } else {
                    alert("일치하는 회원 정보가 없습니다.");
                }
                $("#btnSendCode").prop("disabled", false).text("인증번호 재전송");
            });
        });

        // 2. 인증번호 확인 및 토큰 획득
        $("#btnVerify").click(function(){
            $.post("/member/verifyAuthCode", { authCode: $("#authCode").val() }, function(res) {
                if(res.result === "OK") {
                    alert("인증 성공!");
                    // 서버에서 발행한 토큰을 가지고 이동
                    location.href = "/member/resetPw?token=" + res.token;
                } else {
                    alert("인증번호가 일치하지 않습니다.");
                }
            });
        });
    });
    </script>
</body>
</html>