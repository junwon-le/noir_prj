<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>NOIR - Reset Password</title>
    <link rel="stylesheet" type="text/css" th:href="@{/common/css/homepage/base.css}">
    <script th:src="@{/common/js/comm/jquery-3.5.1.min.js}"></script>
    <style>
        /* findPw와 동일한 테마 스타일 */
        body { background: #0f1218; color: #fff; font-family: 'Noto Sans KR', sans-serif; }
        .find-box { 
            background: rgba(44, 41, 38, 0.95); padding: 40px; border-radius: 15px; 
            border: 1px solid #7c6a52; text-align: center; max-width: 450px; margin: 100px auto;
        }
        .find-title { color: #C4A16F; font-size: 24px; margin-bottom: 20px; letter-spacing: 2px; }
        input[type="password"] { 
            width: 100%; height: 42px; background: rgba(255, 255, 255, 0.05); 
            border: 1px solid #5a4d3b; color: #fff; padding: 10px; margin-bottom: 10px;
        }
        .msg { font-size: 12px; text-align: left; margin-bottom: 15px; display: none; }
        .error { color: #ff4d4d; }
        .success { color: #4dff4d; }
    </style>
</head>
<body>
    <header th:replace="~{fragments/header :: header}"></header>

    <div class="find-box">
        <h2 class="find-title">RESET PASSWORD</h2>
        <p style="color:#888; font-size:13px; margin-bottom:25px;">새로운 비밀번호를 입력해 주세요.</p>
        
        <input type="hidden" id="token" th:value="${token}">
        
        <div class="input-group">
            <input type="password" id="newPw" placeholder="새 비밀번호">
        </div>
        <div class="input-group">
            <input type="password" id="confirmPw" placeholder="비밀번호 확인">
            <p id="pwMatchMsg" class="msg"></p>
        </div>
        
        <button type="button" class="submit-btn" id="btnUpdatePw" style="width: 100%; padding: 12px; background: #C4A16F; border: none; color: #fff; font-weight: bold; cursor: pointer;">
            비밀번호 변경하기
        </button>
    </div>

    <script>
    $(document).ready(function(){
        // 비밀번호 일치 실시간 체크
        $("#newPw, #confirmPw").on("keyup", function(){
            let p1 = $("#newPw").val();
            let p2 = $("#confirmPw").val();
            let $msg = $("#pwMatchMsg");

            if(p2.length === 0) { $msg.hide(); return; }
            $msg.show();
            if(p1 === p2) {
                $msg.text("비밀번호가 일치합니다.").addClass("success").removeClass("error");
            } else {
                $msg.text("비밀번호가 일치하지 않습니다.").addClass("error").removeClass("success");
            }
        });

        // 최종 변경 요청
        $("#btnUpdatePw").click(function(){
            let newPw = $("#newPw").val();
            let token = $("#token").val();

            if(newPw !== $("#confirmPw").val()) return alert("비밀번호를 다시 확인해주세요.");
            if(newPw.length < 4) return alert("비밀번호는 4자 이상이어야 합니다.");

            $.post("/member/modifyPwProcess", { newPw: newPw, token: token }, function(res) {
                if(res === "OK") {
                    alert("비밀번호가 성공적으로 변경되었습니다. 로그인 페이지로 이동합니다.");
                    location.href = "/member/login";
                } else {
                    alert("오류가 발생했습니다. 다시 시도해 주세요.");
                    location.href = "/member/findPw";
                }
            });
        });
    });
    </script>
</body>
</html>