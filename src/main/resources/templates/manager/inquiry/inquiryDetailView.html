<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="title" content="HOTEL 28">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>HOTEL 28</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.css" rel="stylesheet">
<!-- jQeury CDN 시작 -->
<link rel="stylesheet" type="text/css" href="/common/css/homepage/base.css">
<link rel="stylesheet" type="text/css" href="/common/css/homepage/style.css?v=0312">
<link rel="stylesheet" type="text/css" href="/common/css/homepage/sub.css?v=0312">
<!-- jQeury CDN 시작 -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

<script src="/common/js/comm/jquery.bxslider.js"></script>
<script src="/common/js/homepage/jquery.rwdImageMaps.min.js"></script>
<script src="/common/js/homepage/jquery.accessibility.modal.js"></script>
<script src="/common/js/comm/jquery.cookie.js"></script>
<script src="/common/js/homepage/plugin.js"></script>
<script src="/common/js/homepage/custom.js"></script>

<style>
/* ===============================
   Inquiry List (Light Admin)
   =============================== */
.inquiry-row.active { background: #eef3ff; }

/* 카드 */
.inquiry-card{
  background: #ffffff;
  border-radius: 14px;
  border: 1px solid #e3e8f3;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
  overflow: hidden;
}

/* 테이블 */
.inquiry-table{
  background: transparent;
  color: #38599a;
  margin-bottom: 0;
}

.inquiry-table thead{ background: #f6f8fc; }

.inquiry-table thead th{
  border-bottom: 1px solid #e3e8f3;
  color: #38599a;
  font-weight: 600;
  padding: 14px;
}

/* 바디 */
.inquiry-table tbody td{
  border-top: 1px solid #e3e8f3;
  padding: 14px;
  vertical-align: middle;
}

/* 행 hover */
.inquiry-row{
  cursor: pointer;
  transition: background 0.2s ease;
}
.inquiry-row:hover{ background: #f9fbff; }

/* 제목 왼쪽 정렬 */
.inquiry-table .text-left{ text-align: left; }

/* 데이터 없을 때 */
.empty-text{
  padding: 40px 0;
  color: #b1c1e2;
  font-size: 14px;
}

/* 페이징 */
.pagination-wrap{
  text-align: center;
  margin-top: 20px;
}

/* ===============================
   Inquiry Detail (Light Admin)
   =============================== */
#inquiryDetailBox{ margin-top: 40px; }

/* 상세 패널 */
.inquiry-detail-panel{
  background: #ffffff;
  border: 1px solid #e3e8f3;
  border-radius: 12px;
  padding: 20px;
}

/* 상세 테이블 */
.inquiry-detail-table{
  color: #38599a;
  font-size: 15px;
}

.inquiry-detail-table th{
  width: 160px;
  background: #f6f8fc;
  color: #38599a;
  font-weight: 600;
  vertical-align: middle;
  padding: 16px;
}

.inquiry-detail-table td{
  padding: 16px;
  background: #ffffff;
}

/* 문의 내용 */
#detailContent{
  min-height: 120px;
  line-height: 1.6;
}

/* 답변 textarea */
#detailAnswer{
  min-height: 160px;
  font-size: 14px;
  border: 1px solid #e3e8f3;
}

/* 버튼 영역 */
.inquiry-detail-actions{
  margin-top: 20px;
  text-align: right;
}

.inquiry-detail-actions button{
  min-width: 100px;
  margin-left: 8px;
}

/* ✅✅ 답변 버튼 (Blue) - Bootstrap btn-secondary/disabled까지 확실히 덮어쓰기 */
#answerBtn{
  background: #38599a !important;
  border: 1px solid #38599a !important;
  color: #fff !important;
  font-weight: 700;
  border-radius: 10px;
  padding: 10px 18px;

  box-shadow: 0 8px 18px rgba(56, 89, 154, 0.25);
  transition: transform .15s ease, background-color .15s ease, border-color .15s ease, box-shadow .15s ease;
}

#answerBtn:hover{
  background: #2f4f8b !important;
  border-color: #2f4f8b !important;
  transform: translateY(-1px);
  box-shadow: 0 10px 22px rgba(47, 79, 139, 0.28);
}

/* ✅ disabled 상태: Bootstrap이 주는 opacity/필터도 제거 */
#answerBtn:disabled,
#answerBtn.disabled{
  background: #e9edf5 !important;
  border-color: #e3e8f3 !important;
  color: #a9b7d3 !important;

  opacity: 1 !important;
  filter: none !important;
  box-shadow: none !important;

  cursor: not-allowed;
  transform: none !important;
}

#deleteBtn{
  background: #c94a4a;
  border: none;
  color: #ffffff;
}
#deleteBtn:hover{ background: #b13e3e; }

#detailAnswer:enabled{
  background: #ffffff;
  border: 1px solid #3f5fa9;
}

/* 페이지네이션 위치 */
.inquiry-pagination{
  margin-top: 28px;
  text-align: center;
}

/* 검색 버튼 (관리자 톤) */
.btn-search{
  background: #b1c1e2;
  border: none;
  color: #ffffff;
  font-weight: 600;
  height: 34px;
  padding: 6px 16px;
}
.btn-search:hover{
  background: linear-gradient(135deg, #4b6fc0, #345aa0);
  color: #ffffff;
}

#searchFrm .form-control{
  height: 34px;
  font-size: 14px;
}

/* 검색 input 전용 */
#searchFrm .form-control{
  margin-bottom: 0;
  min-width: 130px;
  background: #ffffff;
  color: #38599a;
  border: 1px solid #e3e8f3;
  padding: 8px 12px;
  border-radius: 8px;
}

.form-control:hover{ background: #f6f8fc; }
</style>

<script>
$(function () {

  // row 클릭 -> ajax로 상세 조회
  $('.inquiry-row').on('click', function () {
    $('.inquiry-row').removeClass('active');
    $(this).addClass('active');

    var inquiryNum = $(this).data('num');

    $.ajax({
      url: '/inquiryAdmin/inquiryDetailAjax',
      type: 'GET',
      data: { inquiryNum: inquiryNum },
      dataType: 'json',
      success: function (data) {
        // 상세 패널 표시
        $('#inquiryDetailBox').removeClass('d-none');

        // hidden 세팅 (답변/삭제에서 사용)
        $('#detailInquiryNum').val(data.inquiryNum);
        $('#deleteInquiryNum').val(data.inquiryNum);

        // 텍스트 채우기
        $('#detailTitle').text(data.inquiryTitle || '-');
        $('#detailEmail').text(data.memberEmail || '-');
        $('#detailWriter').text(data.memberId != null ? data.memberId : '-');
        $('#detailContent').text(data.inquiryMsg || '-');

        // 답변
        $('#detailAnswer').prop('disabled', false).val(data.inquiryReturn || '');

        // 버튼 활성화
        $('#answerBtn').prop('disabled', false);
        $('#deleteBtn').prop('disabled', false);
      },
      error: function () {
        alert('상세 조회에 실패했습니다.');
      }
    });
  });

  // 답변 버튼 -> 폼 submit (ajax 아님)
  $('#answerBtn').on('click', function () {
    if ($('#detailInquiryNum').val() === '') {
      alert('문의를 선택해주세요.');
      return;
    }
    if ($('#detailAnswer').val().trim() === '') {
      alert('답변을 입력해주세요.');
      $('#detailAnswer').focus();
      return;
    }
    $('#answerFrm').submit();
  });

  // 삭제 버튼 -> 폼 submit (ajax 아님)
  $('#deleteBtn').on('click', function () {
    if ($('#deleteInquiryNum').val() === '') {
      alert('문의를 선택해주세요.');
      return;
    }
    if (confirm('정말 삭제하시겠습니까?')) {
      $('#deleteFrm').submit();
    }
  });

});
</script>

</head>

<body>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->

<th:block th:replace="~{fragments/sidebar :: sidebar}"></th:block>

<div class="all-content-wrapper">
  <div class="header-advance-area">
    <div class="breadcome-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="breadcome-list">
              <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                  <div class="breadcomb-wp" style="color: #ffffff; font-size: 20px">문의사항 관리</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container" style="color: #ffffff; min-height: 700px">

    <div style="margin-bottom: 20px;">
      <h3 style="font-weight: 600;">문의사항 목록</h3>
    </div>

    <div style="margin: 20px 0; text-align: left;">
      <form id="searchFrm" th:action="@{/inquiryAdmin/inquiryListAdmin}" method="get" class="form-inline" style="margin:20px 0;">
        <input type="hidden" name="currentPage" value="1">
        <input type="text" name="keyword" th:value="${param.keyword}" class="form-control"
               placeholder="제목 검색" style="width:220px; margin-right:6px;">
        <button type="submit" class="btn btn-search">검색</button>
      </form>
    </div>

    <div class="panel panel-default inquiry-card">
      <div class="panel-body" style="padding:0;">
        <table class="table inquiry-table text-center">
          <thead>
            <tr>
              <th style="width:80px;">번호</th>
              <th>제목</th>
              <th style="width:150px;">작성자</th>
              <th style="width:120px;">등록일</th>
            </tr>
          </thead>

          <tbody>
            <tr th:if="${#lists.isEmpty(inquiryList)}">
              <td colspan="4" class="empty-text">등록된 문의가 없습니다.</td>
            </tr>

            <tr class="inquiry-row"
                th:each="inquiry, i : ${inquiryList}"
                th:attr="data-num=${inquiry.inquiryNum}">
              <td th:text="${listNum - i.index}"></td>
              <td class="text-left" th:text="${inquiry.inquiryTitle}"></td>
              <td th:text="${inquiry.memberEmail != null ? inquiry.memberEmail : inquiry.memberId}"></td>
              <td th:text="${#dates.format(inquiry.inquiryDate, 'yyyy-MM-dd')}"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="pagination-wrap">
      <div th:utext="${pagination}"></div>
    </div>

    <div id="inquiryDetailBox" class="d-none">
      <div class="panel inquiry-detail-panel">
        <div class="panel-body">

          <form id="answerFrm" th:action="@{/inquiryAdmin/replyInquiryProcess}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

            <input type="hidden" name="inquiryNum" id="detailInquiryNum">
            <input type="hidden" name="currentPage" th:value="${param.currentPage == null ? 1 : param.currentPage}">
            <input type="hidden" name="keyword" th:value="${param.keyword}">
            <input type="hidden" name="field" th:value="${param.field}">

            <table class="table table-bordered inquiry-detail-table">
              <tr>
                <th>제목</th>
                <td id="detailTitle" class="text-muted">문의를 선택해주세요.</td>
              </tr>
              <tr>
                <th>이메일</th>
                <td id="detailEmail">-</td>
              </tr>
              <tr>
                <th>글쓴이</th>
                <td id="detailWriter">-</td>
              </tr>
              <tr>
                <th>문의 내용</th>
                <td id="detailContent">-</td>
              </tr>
              <tr>
                <th>답변</th>
                <td>
                  <textarea id="detailAnswer" name="inquiryReturn" class="form-control"
                            placeholder="문의 선택 후 답변을 작성할 수 있습니다." disabled></textarea>
                </td>
              </tr>
            </table>

            <div class="inquiry-detail-actions">
              <button type="button" class="btn btn-danger" id="deleteBtn" disabled>삭제</button>
              <!-- ✅ btn-secondary 제거: CSS랑 충돌 방지 -->
              <button type="button" class="btn" id="answerBtn" disabled>답변</button>
            </div>
          </form>

          <form id="deleteFrm" th:action="@{/inquiryAdmin/removeInquiry}" method="post">
            <input type="hidden" name="inquiryNum" id="deleteInquiryNum">
            <input type="hidden" name="currentPage" th:value="${param.currentPage == null ? 1 : param.currentPage}">
            <input type="hidden" name="keyword" th:value="${param.keyword}">
            <input type="hidden" name="field" th:value="${param.field}">
          </form>

        </div>
      </div>
    </div>

  </div>
</div>

<th:block th:replace="~{fragments/footer :: footer}"></th:block>

<!-- 아래 JS들은 원본 유지 -->
<script src="js/wow.min.js"></script>
<script src="js/jquery-price-slider.js"></script>
<script src="js/jquery.meanmenu.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.sticky.js"></script>
<script src="js/jquery.scrollUp.min.js"></script>
<script src="js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="js/scrollbar/mCustomScrollbar-active.js"></script>
<script src="js/metisMenu/metisMenu.min.js"></script>
<script src="js/metisMenu/metisMenu-active.js"></script>
<script src="js/sparkline/jquery.sparkline.min.js"></script>
<script src="js/sparkline/jquery.charts-sparkline.js"></script>
<script src="js/calendar/moment.min.js"></script>
<script src="js/calendar/fullcalendar.min.js"></script>
<script src="js/calendar/fullcalendar-active.js"></script>
<script src="js/flot/jquery.flot.js"></script>
<script src="js/flot/jquery.flot.resize.js"></script>
<script src="js/flot/curvedLines.js"></script>
<script src="js/flot/flot-active.js"></script>
<script src="js/plugins.js"></script>
<script src="js/main.js"></script>

</body>
</html>