<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>NOIR호텔 관리자 페이지</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Fonts
		============================================ -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet">
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/bootstrap.min.css">
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/font-awesome.min.css">
	<!-- nalika Icon CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/nalika-icon.css">
    <!-- owl.carousel CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/owl.carousel.css">
    <link rel="stylesheet" href="/admin_common/css/owl.theme.css">
    <link rel="stylesheet" href="/admin_common/css/owl.transitions.css">
    <!-- animate CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/animate.css">
    <!-- normalize CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/normalize.css">
    <!-- meanmenu icon CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/meanmenu.min.css">
    <!-- main CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/main.css">
    <!-- morrisjs CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/morrisjs/morris.css">
    <!-- mCustomScrollbar CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/scrollbar/jquery.mCustomScrollbar.min.css">
    <!-- metisMenu CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/metisMenu/metisMenu.min.css">
    <link rel="stylesheet" href="/admin_common/css/metisMenu/metisMenu-vertical.css">

    <link rel="stylesheet" href="/admin_common/style.css">
    <!-- responsive CSS
		============================================ -->
    <link rel="stylesheet" href="/admin_common/css/responsive.css">
    <!-- jquery
		============================================ -->
    <script src="/admin_common/js/vendor/jquery-1.12.4.min.js"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="/admin_common/js/bootstrap.min.js"></script>
    <!-- wow JS
		============================================ -->
    <script src="/admin_common/js/wow.min.js"></script>
    <!-- price-slider JS
		============================================ -->
    <script src="/admin_common/js/jquery-price-slider.js"></script>
    <!-- meanmenu JS
		============================================ -->
    <script src="/admin_common/js/jquery.meanmenu.js"></script>
    <!-- owl.carousel JS
		============================================ -->
    <script src="/admin_common/js/owl.carousel.min.js"></script>
    <!-- sticky JS
		============================================ -->
    <script src="/admin_common/js/jquery.sticky.js"></script>
    
    <!-- mCustomScrollbar JS
		============================================ -->
    <script src="/admin_common/js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="/admin_common/js/scrollbar/mCustomScrollbar-active.js"></script>
    <!-- metisMenu JS
		============================================ -->
    <script src="/admin_common/js/metisMenu/metisMenu.min.js"></script>
    <script src="/admin_common/js/metisMenu/metisMenu-active.js"></script>
    <!-- sparkline JS
		============================================ -->
    <script src="/admin_common/js/sparkline/jquery.sparkline.min.js"></script>
    <script src="/admin_common/js/sparkline/jquery.charts-sparkline.js"></script>
    <!-- calendar JS
		============================================ -->
    <script src="/admin_common/js/calendar/moment.min.js"></script>
    <script src="/admin_common/js/calendar/fullcalendar.min.js"></script>
    <script src="/admin_common/js/calendar/fullcalendar-active.js"></script>
	<!-- float JS
		============================================ -->
    <script src="/admin_common/js/flot/jquery.flot.js"></script>
    <script src="/admin_common/js/flot/jquery.flot.resize.js"></script>
    <script src="/admin_common/js/flot/curvedLines.js"></script>
    <script src="/admin_common/js/flot/flot-active.js"></script>
    <!-- plugins JS
		============================================ -->
    <script src="/admin_common/js/plugins.js"></script>
    <!-- main JS
		============================================ -->
    <script src="/admin_common/js/main.js"></script>


<style>
.sun{
color: red;
width:300px;
text-align: center;
height:40px;
font-size: 20px;
}
.normal{
color:black;
width:300px;
text-align: center;
font-size: 20px;
}
.sat{
color:blue;
width:300px;
text-align: center;
font-size: 20px;
}

.calendar-table th {
    border: none;
    background: #f8fafc;
    font-weight: 600;
    color: #334155;
    padding: 18px 0;
    font-size: 15px;
}

td{
border:1px solid #333;
color:black;
height:100px;
text-align: left;
vertical-align: top;
}


.price{
border:0px solid #333;

}

.calendar-table {
    width: 100%;
    border-collapse: collapse;
    background: #ffffff;
    border-radius: 12px;
    overflow: hidden;
    font-size: 13px;
}

.calendar-table th {
    background: #f1f5f9;
    color: #334155;
    padding: 14px 0;
    border-bottom: 1px solid #e2e8f0;
    font-weight: 600;
}

.calendar-table td {
    height: 110px;
    vertical-align: top;
    padding: 10px;
    border: 1px solid #e2e8f0;
    position: relative;
    transition: background 0.2s ease;
    background: #ffffff;
}

/* hover 효과 */
.calendar-table td:hover {
    background: #f8fafc;
}

/* 날짜 숫자 */
.calendar-table td > span,
.calendar-table td:first-child {
    font-weight: 600;
    color: #334155;
}

/* 주말 */
.calendar-table td[style*="red"] {
    background: #fff5f5;
}

.calendar-table td[style*="blue"] {
    background: #f0f7ff;
}

/* 체크박스 */
.calendar-table input[type="checkbox"] {
    margin-top: 6px;
    cursor: pointer;
}

/* 가격 input */
.price {
    width: 100%;
    margin-top: 6px;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid #e2e8f0;
    font-size: 12px;
    background: #f8fafc;
    text-align: right;
}

.price[readonly] {
    background: #eef2ff;
    color: #1e40af;
    font-weight: 600;
}


#calandar table {
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}


</style>

<script th:if="${msg != null}">
    alert("[[${msg}]]");
</script>
    
<script>

$(function () {

    /* ===============================
       체크박스 단일 선택
    =============================== */
    $(".sel").change(function () {
        if ($(this).prop("checked")) {
            $(".sel").not(this).prop("checked", false);
        }
    });

    /* ===============================
       수정 버튼
    =============================== */
    $("#modifyBtn").click(function () {

        const price = $("#roomPrice").val();

        if (price === "") {
            alert("가격을 입력하세요");
            return;
        }

        if (!isNumberOnly(price)) {
            alert("가격을 잘못입력하였습니다.");
            return;
        }

        if (!$(".holiday:checked").length && !$(".workday:checked").length) {
            alert("날짜를 선택해주세요.");
            return;
        }

        const month = $("#roomPriceMonth").val();
        sessionStorage.setItem("roomPriceMonth", month);

        $("#frm").submit();
    });

    /* ===============================
       선택 옵션들
    =============================== */
    $("#allSel").change(function () {
        $(".holiday, .workday").prop("checked", false);

        $(".holiday").prop("checked", function (i, ele) {
            return !ele;
        });

        $(".workday").prop("checked", function (i, ele) {
            return !ele;
        });
    });

    $("#holSel").change(function () {
        $(".holiday, .workday").prop("checked", false);

        if (this.checked) {
            $(".holiday").prop("checked", true);
        }
    });

    $("#workSel").change(function () {
        $(".holiday, .workday").prop("checked", false);

        if (this.checked) {
            $(".workday").prop("checked", true);
        }
    });

    $("#cancelBtn").click(function () {
        history.back();
    });

    /* ===============================
       ✅ 달력 초기화 (중요)
    =============================== */
    const roomTypeNum = $("#roomTypeNum").val();

    // sessionStorage → 없으면 현재 월
    const savedMonth = sessionStorage.getItem("roomPriceMonth");
    const initMonth = savedMonth ?? new Date().toISOString().slice(0, 7);

    // input[type=month] 맞추기
    $("#roomPriceMonth").val(initMonth);

    // 최초 달력 생성
    createCalandar(initMonth, roomTypeNum);

    // 월 변경 시
    $("#roomPriceMonth").change(function () {
        const month = $(this).val();
        sessionStorage.setItem("roomPriceMonth", month);
        createCalandar(month, roomTypeNum);
    });

});


function createCalandar(e,n){
	$.ajax({
		url:"/room/calandarProcess",
		data:{
			roomPriceDate:e, roomTypeNum:n
		},
		dataType:"json",
		error:function(xhr){
			alert("달력 로딩 실패");
			console.log(xhr.status);
			console.log("response:", xhr.responseText);
		},
		success:function(json){
			drawCalandar(json);
		}
	})
	
}
function drawCalandar(e) {

    const $tbody = $("#calandar tbody");
    $tbody.empty(); // ⭐ 완전 초기화

    let html = "<tr>";
    let cellCount = 0; // 전체 셀 카운트 (7칸 기준)

    // 1️⃣ 첫 요일 이전 빈칸
    for (let i = 0; i < e.firstDay; i++) {
        html += "<td></td>";
        cellCount++;
    }

    // 2️⃣ 날짜 출력
    for (let day = 1; day <= e.lastDate; day++) {

        const price = getPriceByDay(e.priceList, day);
        const weekday = cellCount % 7;

        let priceHtml =
            "<input type='text' class='price' value=''>" +
            "<input type='hidden' value='-1'>";

        if (price !== null) {
            priceHtml =
                "<input type='text' readonly='readonly' class='price' value='" + price.toLocaleString() + "'>" +
                "<input type='hidden' value='" + price + "'>";
        }

        let tdStyle = "";
        let checkboxClass = "workday";

        if (weekday === 0) {
            tdStyle = "style='color:red'";
            checkboxClass = "holiday";
        } else if (weekday === 6) {
            tdStyle = "style='color:blue'";
            checkboxClass = "holiday";
        }

        html += `
        	<td ${tdStyle}>
        	    <div style="font-weight:600; margin-bottom:4px;">${day}</div>
        	    <input type="checkbox" name="roomPriceDates"
        	           class="${checkboxClass}" value="${day}">
        	    ${priceHtml}
        	</td>
        	`;


        cellCount++;

        // 3️⃣ 7칸마다 줄바꿈
        if (cellCount % 7 === 0 && day !== e.lastDate) {
            html += "</tr><tr>";
        }
    }

    // 4️⃣ 마지막 주 빈칸 채우기
    while (cellCount % 7 !== 0) {
        html += "<td></td>";
        cellCount++;
    }

    html += "</tr>";

    $tbody.html(html);
}



function getPriceByDay(priceList, day) {
    if (!priceList) return null;

    for (var i = 0; i < priceList.length; i++) {
        var date = priceList[i].roomPriceDate; // yyyy-MM-dd
        
        var d = parseInt(date.split("-")[2], 10);

        if (d === day) {
            return priceList[i].roomPrice;
        }
    }
    return null;
}


function isNumberOnly(value) {
    for (let i = 0; i < value.length; i++) {
        const code = value.charCodeAt(i);
        if (code < 48 || code > 57) {
            return false;
        }
    }
    return true;
}

	
</script>
    
</head>

<body>
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

    <div th:replace="~{manager/fragments/sidebar :: sidebar}"></div>
    <!-- Start Welcome area -->
    <div class="all-content-wrapper">
        <div class="header-advance-area">
            <div class="breadcome-area">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="breadcome-list" style="margin-left:40px; width:95%; border-radius: 20px;">
                                <div class="row">
                                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                        <div class="breadcomb-wp" style="color:#ffffff; font-size: 20px">
											가격 설정
										</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="contatiner" style="height:1050px; color:#ffffff">
        <div>
			<form action="/admin/roomManagePriceProcess" id="frm" method="post">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">					
                   <div class="breadcome-list" style="margin-left:35px; width:1655px; border-radius: 20px;">
					<div style="background: #1a233b; padding: 30px; border-radius: 15px; color: #ffffff; font-family: 'Pretendard', sans-serif; min-width: 800px;">
    
    <div style="text-align: center; margin-bottom: 25px;">
    	<input type="hidden" name="roomTypeNum" id="roomTypeNum" th:value="${param.num}">
        <input type="month"
       name="roomPriceMonth"
       id="roomPriceMonth"
       style="padding: 8px 15px; border-radius: 6px; border: 1px solid #3d4b7a; background: #252f4a; color: white; font-weight: bold; font-size: 16px; outline: none;">

        <input type="hidden" name="paramMonth">
    </div>

    <div style="
    background: #ffffff;
    border-radius: 12px;
    overflow: hidden;
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    border: 1px solid #e0e6f0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
">
       <div id="calandar"
         style="grid-column: 1 / -1; display:flex; justify-content:center;">
        	<table class="calendar-table">


        	<thead>
        	<tr>
        	<th class="sun">일</th>
        	<th class="normal">월</th>
        	<th class="normal">화</th>
        	<th class="normal">수</th>
        	<th class="normal">목</th>
        	<th class="normal">금</th>
        	<th class="sat">토</th>
        	</tr>
        	</thead>
        	<tbody>
        	
        	</tbody>
        	</table>
        
        </div>        
    </div>

    <div style="margin-top: 25px; display: flex; flex-direction: column; align-items: center; gap: 20px;">
        <div style="display: flex; align-items: center; gap: 20px; font-size: 15px;">
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;"><input type="checkbox" style="width: 16px; height: 16px;" name="selName" class="sel" id="allSel"> 전체선택</label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;"><input type="checkbox" style="width: 16px; height: 16px;" name="selName" class="sel" id="workSel"> 평일만선택</label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;"><input type="checkbox" style="width: 16px; height: 16px;" name="selName" class="sel" id="holSel"> 주말만선택</label>
            <input type="text" id="roomPrice" name="roomPrice" placeholder="가격을 입력하세요." style="color:#000000; padding: 10px 15px; border-radius: 8px; border: none; width: 180px; font-size: 14px; outline: none;">
            
        </div>
        
    </div>
   
</div>

    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 10px; border-top: 1px solid #eee; padding-top: 20px;">
        <input id="cancelBtn" type="button" style="
            padding: 10px 35px; 
            border: 2px solid #7495CC; 
            border-radius: 10px; 
            background-color: white; 
            color: #7495CC; /* 취소 버튼색을 메인색으로 변경 제안 (가독성) */
            font-weight: 600; 
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s ease;
        " 
        onmouseover="this.style.backgroundColor='#f0f4ff';" 
        onmouseout="this.style.backgroundColor='white';" value="취소" onclick=history:back()>
         
        

        <input type="button" id="modifyBtn" style="
            padding: 10px 35px; 
            border: none; 
            border-radius: 10px; 
            background-color: #7495CC; 
            color: white; 
            font-weight: 600; 
            cursor: pointer;
            font-size: 15px;
            box-shadow: 0 3px 8px rgba(116, 149, 204, 0.3);
            transition: background-color 0.3s ease;
        " 
        onmouseover="this.style.backgroundColor='#6482FF';" 
        onmouseout="this.style.backgroundColor='#7495CC';" value="수정">
            
    </div>
</div>
	 </form>	
						
							</div>
                        	

                   		</div>
                	</div>
        <!-- 막기 -->
    
       <div th:replace="~{manager/fragments/footer :: footer}"></div>
</body>

</html>