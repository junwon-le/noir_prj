<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>NOIR호텔 관리자 페이지</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Admin Common CSS -->
<link rel="stylesheet" href="/admin_common/css/bootstrap.min.css">
<link rel="stylesheet" href="/admin_common/css/font-awesome.min.css">
<link rel="stylesheet" href="/admin_common/css/nalika-icon.css">
<link rel="stylesheet" href="/admin_common/css/animate.css">
<link rel="stylesheet" href="/admin_common/css/normalize.css">
<link rel="stylesheet" href="/admin_common/css/meanmenu.min.css">
<link rel="stylesheet" href="/admin_common/css/main.css">
<link rel="stylesheet" href="/admin_common/css/scrollbar/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="/admin_common/css/metisMenu/metisMenu.min.css">
<link rel="stylesheet" href="/admin_common/css/metisMenu/metisMenu-vertical.css">
<link rel="stylesheet" href="/admin_common/style.css">
<link rel="stylesheet" href="/admin_common/css/responsive.css">

<!-- Admin Common JS (jQuery 먼저) -->
<script src="/admin_common/js/vendor/jquery-1.12.4.min.js"></script>
<script src="/admin_common/js/bootstrap.min.js"></script>
<script src="/admin_common/js/metisMenu/metisMenu.min.js"></script>
<script src="/admin_common/js/metisMenu/metisMenu-active.js"></script>
<script src="/admin_common/js/plugins.js"></script>
<script src="/admin_common/js/main.js"></script>

<!-- Summernote -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.js"></script>

<style>
.notice-form-wrap{
  background:#ffffff;
  border:1px solid #e3e8f3;
  border-radius:12px;
  padding:18px;
}
.notice-form-title{ font-weight:600; margin-bottom:20px; color:#ffffff; }
.btn-save{
  background:linear-gradient(135deg,#3f5fa9,#2b4a87);
  color:#fff;border:none;padding:8px 18px;border-radius:8px;font-weight:600;
}
.btn-save:hover{ opacity:0.9; }

.btn-danger,.btn-success,.btn-info{
  border-radius:8px!important;
  padding:8px 18px!important;
  font-weight:600!important;
  border:none!important;
}
.notice-form-wrap,.notice-form-wrap label,.notice-form-wrap .form-label{ color:#38599a; }
.notice-form-wrap .form-control,.notice-form-wrap .form-select,.notice-form-wrap textarea{
  background:#ffffff!important;
  color:#38599a!important;
  border:1px solid #e3e8f3!important;
  border-radius:10px!important;
  padding:10px 12px!important;
  box-shadow:none!important;
}
.notice-form-wrap .form-select option{ color:#38599a; }
.notice-form-wrap .form-control:focus,.notice-form-wrap .form-select:focus,.notice-form-wrap textarea:focus{
  border-color:#5f739c!important;
  outline:none!important;
  box-shadow:0 0 0 0.15rem rgba(95,115,156,0.25)!important;
}
.btn-area{
  display:flex; gap:10px;
  justify-content:flex-end; align-items:center;
  margin-top:12px;
}
.btn-area .btn-secondary{
  background:#5f739c!important;
  border:1px solid #e3e8f3!important;
  color:#ffffff!important;
  border-radius:8px!important;
  padding:8px 18px!important;
  font-weight:600;
  text-decoration:none;
}
.btn-area .btn-secondary:hover{ opacity:0.9; }

/* Summernote 보정 */
.note-editor.note-frame{
  border:1px solid #e3e8f3!important;
  border-radius:12px!important;
  overflow:hidden;
  width:100%!important; max-width:100%!important;
}
.note-editor .note-toolbar{
  background:#f7f9ff!important;
  border-bottom:1px solid #e3e8f3!important;
}
.note-editor .note-editable{
  background:#ffffff!important;
  color:#38599a!important;
  padding:14px 16px!important;
  line-height:1.6!important;
  min-height:260px;
}
.note-editor .note-statusbar{
  border-top:1px solid #e3e8f3!important;
  background:#ffffff!important;
}
.note-editor .note-placeholder{ color:rgba(56,89,154,0.55)!important; }
.note-editor .note-btn,.note-editor .note-icon-font{ color:#38599a!important; }
</style>

<script type="text/javascript">
$(function () {

  // ✅ 상세 페이지에서도 내용은 summernote로 보여주고 수정 가능하게
  $('#noticeMsg').summernote({
    height: 320,
    placeholder: '내용을 입력하세요'
  });

//✅ 초기화 전에 textarea의 원래 내용을 확보
  var initHtml = $("#noticeMsg").text();   // th:text로 들어온 값 확보

  // ✅ Summernote 초기화
  $('#noticeMsg').summernote({
    height: 320,
    placeholder: '내용을 입력하세요'
  });

  // ✅ 확보한 내용으로 에디터 세팅
  if (initHtml && initHtml.trim() !== "") {
    $('#noticeMsg').summernote('code', initHtml);
  }


  $("#btnModify").on("click", function () {
    if (!confirm("공지사항을 정말 수정하시겠습니까?")) return;

    var title = $("#noticeTitle").val().trim();
    if (title === "") { alert("제목은 필수 입력입니다."); $("#noticeTitle").focus(); return; }

    var category = $("#noticeCategory").val().trim();
    if (category === "") { alert("카테고리는 필수 입력입니다."); $("#noticeCategory").focus(); return; }

    var msg = $('#noticeMsg').summernote('code');
    var plain = $('<div>').html(msg).text().trim();
    if (plain === "") { alert("내용은 필수 입력입니다."); return; }

    $("#noticeMsg").val(msg);

    $("#frm").attr("action", "/notice/modifyNoticeProcess");
    $("#frm").submit();
  });

  $("#btnDelete").on("click", function () {
    if (!confirm("공지사항을 정말 삭제하시겠습니까?")) return;

    $("#frm").attr("action", "/notice/removeNotice");
    $("#frm").submit();
  });

});
</script>
</head>

<body>

<div th:replace="~{manager/fragments/sidebar :: sidebar}"></div>

<div class="all-content-wrapper">
  <div class="header-advance-area">
    <div class="breadcome-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="breadcome-list">
              <div class="breadcomb-wp" style="color:#ffffff; font-size:20px">
                <h2>공지사항 관리</h2>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 본문 -->
  <div class="container" style="color:white; min-height:700px">
    <h3 class="notice-form-title">공지사항 상세</h3>

    <div class="notice-form-wrap">
    
      <!-- ✅ 모델명 notice로 받는다는 가정 postfh 받아서 토큰 넣어야 함-->
      <form id="frm" method="post" th:object="${notice}">
        <!-- ✅ CSRF 토큰 -->
  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        <!-- 삭제/수정에 필요한 키 -->
        <input type="hidden" name="noticeNum" th:value="*{noticeNum}">
        <!-- 목록에서 넘어온 currentPage 유지 -->
<input type="hidden" name="currentPage"
       th:value="${param.currentPage != null ? param.currentPage[0] : 1}">

        <div class="mb-3">
          <label class="form-label">제목</label>
          <input type="text" class="form-control"
                 name="noticeTitle" id="noticeTitle"
                 th:value="*{noticeTitle}">
        </div>

        <div class="mb-3">
          <label class="form-label">카테고리</label>
          <select class="form-select" name="noticeCategory" id="noticeCategory">
            <option value="">전체</option>
            <option value="일반공지" th:selected="*{noticeCategory} == '일반공지'">일반공지</option>
            <option value="멤버십" th:selected="*{noticeCategory} == '멤버십'">멤버십</option>
            <option value="약관개정" th:selected="*{noticeCategory} == '약관개정'">약관개정</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">내용</label>
          <!-- ✅ summernote는 textarea의 value로 초기 내용 가져오게 -->
          <textarea name="noticeMsg" id="noticeMsg" th:text="*{noticeMsg}"></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">작성일</label>
          <div class="form-control" style="background:#f7f9ff!important;" th:text="*{noticeDate}"></div>
        </div>

        <div class="btn-area">
          <button type="button" class="btn-save" id="btnModify">수정</button>
          <button type="button" class="btn btn-danger" id="btnDelete">삭제</button>

        <a class="btn btn-secondary"
   th:href="@{/notice/searchAllNotice(
      currentPage=${param.currentPage != null ? param.currentPage[0] : 1},
      field=${param.field != null ? param.field[0] : '1'},
      keyword=${param.keyword != null ? param.keyword[0] : ''}
   )}">
  목록
</a>

        </div>

      </form>
    </div>
  </div>

  <div th:replace="~{manager/fragments/footer :: footer}"></div>
</div>

</body>
</html>
