<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>NOIR HOTEL - Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet" />
    <link rel="stylesheet" href="/admin_common/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/admin_common/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/admin_common/css/nalika-icon.css" />
    <link rel="stylesheet" href="/admin_common/style.css" />
    <link rel="stylesheet" href="/admin_common/css/metisMenu/metisMenu.min.css" />
    <link rel="stylesheet" href="/admin_common/css/metisMenu/metisMenu-vertical.css" />
    
    <script src="/admin_common/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="/admin_common/js/metisMenu/metisMenu.min.js"></script>
    <script src="/admin_common/js/metisMenu/metisMenu-active.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* [1. 기본 설정] */
        body { 
            background-color: #151c2c; 
            margin: 0; padding: 0; 
            overflow-x: hidden; 
            display: block; 
        }
        
        /* [2. 사이드바 고정] */
        .left-sidebar-pro { 
            width: 210px !important; 
            height: 100% !important;
            position: fixed !important; 
            top: 0; left: 0; 
            z-index: 99999;
            background: #152036 !important;
            overflow-y: auto;
            border-right: 1px solid #1e2538;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        /* [3. 컨텐츠 래퍼] */
        .all-content-wrapper { 
            margin-left: 210px !important; 
            min-height: 100vh;
            background-color: #151c2c;
            display: flex;
            flex-direction: column;
            width: calc(100% - 210px);
        }

        /* [4. 핵심 복구: 컨텐츠 우측 이동 레이아웃] */
        .main-content-inner {
            width: 100%;
            margin: 0; 
            /* "완벽하다"고 하셨던 비율로 복구: 왼쪽 80px, 오른쪽 40px */
            padding-top: 40px;
            padding-left: 80px;  
            padding-right: 40px; 
            padding-bottom: 60px;
            box-sizing: border-box; 
        }

        /* 헤더 스타일: 본문과 라인 일치 */
        .dashboard-header {
            background-color: #1e2538;
            /* 헤더도 본문과 동일하게 왼쪽 80px, 오른쪽 40px */
            padding: 20px 40px 20px 80px; 
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #2d364e;
            position: sticky; top: 0; z-index: 1000;
            width: 100%; box-sizing: border-box;
        }

        /* 그리드 및 카드 스타일 */
        .dashboard-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; }
        .main-content-card { background: #1a253a; border-radius: 12px; padding: 25px; border: 1px solid #2d364e; box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .kpi-box { height: 160px; display: flex; flex-direction: column; justify-content: space-between; }
        .chart-box-large { grid-column: span 2; height: 380px; }
        .chart-box-wide { grid-column: span 2; height: 320px; }
        
        .card-value { font-size: 26px; font-weight: 700; color: #fff; }
        .card-label { font-size: 13px; color: #8b9bb4; font-weight: 500; }
        .icon-round { width: 44px; height: 44px; background: #151c2c; border-radius: 10px; display: flex; justify-content: center; align-items: center; color: #3b82f6; font-size: 19px; }
        .trend-tag { font-size: 12px; font-weight: 600; padding: 2px 8px; border-radius: 4px; }
        .up { color: #4ade80; background: rgba(74, 222, 128, 0.1); }
        .down { color: #f87171; background: rgba(248, 113, 113, 0.1); }
    </style>
</head>

<body>
    <div class="left-sidebar-pro">
        <div th:replace="~{manager/fragments/sidebar :: sidebar}"></div>
    </div>

    <div class="all-content-wrapper">
        <header class="dashboard-header">
            <div style="font-size: 20px; font-weight: bold; color: #fff;">Dashboard Overview</div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <select style="background:#151c2c; color:#fff; border:1px solid #2d364e; padding:7px 15px; border-radius:6px;">
                    <option>이번 주 (Weekly)</option>
                    <option>이번 달 (Monthly)</option>
                </select>
                <div style="width: 36px; height: 36px; background: #3b82f6; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold;">A</div>
            </div>
        </header>

        <div class="main-content-inner">
            <div class="dashboard-grid">
                
                <div class="main-content-card kpi-box">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div class="icon-round"><i class="fa fa-key"></i></div>
                        <span class="trend-tag up">▲ 5.4%</span>
                    </div>
                    <div>
                        <div class="card-label">객실 점유율 (Occupancy)</div>
                        <div class="card-value" th:text="${dash.occupancyRate} + '%'">78.5%</div>
                    </div>
                </div>
                
                <div class="main-content-card kpi-box">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div class="icon-round" style="color:#4ade80;"><i class="fa fa-krw"></i></div>
                        <span class="trend-tag up">▲ 2.1%</span>
                    </div>
                    <div>
                        <div class="card-label">평균 객실 요금 (ADR)</div>
                        <div class="card-value" th:text="'₩ ' + ${#numbers.formatInteger(dash.adr, 3, 'COMMA')}">₩ 215,000</div>
                    </div>
                </div>

                <div class="main-content-card kpi-box">
                    <div class="icon-round" style="color:#a78bfa;"><i class="fa fa-clock-o"></i></div>
                    <div>
                        <div class="card-label">평균 리드 타임</div>
                        <div class="card-value" th:text="${dash.avgLeadTime} + ' 일'">14.5 일</div>
                    </div>
                </div>

                <div class="main-content-card kpi-box">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div class="icon-round" style="color:#fbbf24;"><i class="fa fa-smile-o"></i></div>
                        <span class="trend-tag up">▲ 0.2</span>
                    </div>
                    <div>
                        <div class="card-label">고객 만족도</div>
                        <div class="card-value" th:text="${dash.satisfactionScore} + ' / 5.0'">4.8 / 5.0</div>
                    </div>
                </div>

                <div class="main-content-card chart-box-large">
                    <div style="font-size: 15px; margin-bottom: 20px;color: #8b9bb4;">실시간 예약 현황 (주간)</div>
                    <div style="height:280px; width:100%;"><canvas id="reservationChart"></canvas></div>
                </div>

                <div class="main-content-card chart-box-large">
                    <div style="font-size: 15px; margin-bottom: 20px;color: #8b9bb4;">객실 가용성 및 투숙객</div>
                    <div style="display: flex; height: 100%; align-items: center;">
                        <div style="flex: 1; text-align: center;">
                            <div class="card-label">현재 투숙객</div>
                            <div style="font-size: 40px; font-weight: bold; margin: 10px 0;">
                                <span th:text="${dash.currentGuests}">342</span>
                            </div>
                            <div style="font-size:12px; color:#3b82f6;">
                                ● 체크인 <span th:text="${dash.checkInCount}">12</span>
                                &nbsp; 
                                <span style="color:#8b9bb4;">● 체크아웃 <span th:text="${dash.checkOutCount}">8</span></span>
                            </div>
                        </div>
                        <div style="flex: 1.5; height: 280px;"><canvas id="availabilityChart"></canvas></div>
                    </div>
                </div>

                <div class="main-content-card kpi-box">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div class="icon-round" style="color:#facc15;"><i class="fa fa-krw"></i></div>
                        <span class="trend-tag up">▲ 8.5%</span>
                    </div>
                    <div>
                        <div class="card-label">다이닝 매출</div>
                        <div class="card-value" th:text="'₩ ' + ${#numbers.formatInteger(dash.diningRevenue, 3, 'COMMA')}">₩ 3,450,000</div>
                    </div>
                </div>

                <div class="main-content-card kpi-box">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div class="icon-round" style="color:#f87171;"><i class="fa fa-user-times"></i></div>
                        <span class="trend-tag down">▼ 1.2%</span>
                    </div>
                    <div>
                        <div class="card-label">예약 취소율</div>
                        <div class="card-value" th:text="${dash.cancelRate} + '%'">4.8%</div>
                    </div>
                </div>

                <div class="main-content-card chart-box-wide">
                    <div style="font-size: 15px; margin-bottom: 20px;color: #8b9bb4;">예약 고객 연령대 분석</div>
                    <div style="height:220px;"><canvas id="ageChart"></canvas></div>
                </div>

            </div>
            
            <div th:replace="~{manager/fragments/footer :: footer}" style="margin-top: 50px;"></div>
        </div>
    </div>

    <script th:inline="javascript">
        /* Controller에서 넘겨준 데이터 받기  이클립스의 오류를  피하기 위해 주석 코드와 뒤에 값을 넣음.*/ 
        /* 이클립스 에디터가 정상적인 코드로 인식함. */
        const weeklyData = /*[[${dash.weeklyReservationData}]]*/ []; 
        const ageData = /*[[${dash.ageDemographicsData}]]*/ [];     
        const occupied = /*[[${dash.occupiedRooms}]]*/ 0;
        const available = /*[[${dash.availableRooms}]]*/ 0;

        Chart.defaults.color = '#8b9bb4';
        Chart.defaults.borderColor = '#2d364e';

        // 1. 주간 예약 차트
        new Chart(document.getElementById('reservationChart'), {
            type: 'bar',
            data: {
                labels: ['월', '화', '수', '목', '금', '토', '일'],
                datasets: [{ 
                    label: '예약', 
                    data: weeklyData, 
                    backgroundColor: '#3b82f6', 
                    borderRadius: 5 
                }]
            },
            options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });

        // 2. 가용성 차트
        new Chart(document.getElementById('availabilityChart'), {
            type: 'doughnut',
            data: {
                labels: ['사용 중', '가용'],
                datasets: [{ 
                    data: [occupied, available], 
                    backgroundColor: ['#3b82f6', '#2d364e'], 
                    borderWidth: 0 
                }]
            },
            options: { cutout: '75%', maintainAspectRatio: false }
        });

        // 3. 연령대 차트
        new Chart(document.getElementById('ageChart'), {
            type: 'bar',
            data: {
                labels: ['20대', '30대', '40대', '50대', '60대+'],
                datasets: [{ 
                    data: ageData, 
                    backgroundColor: '#3b82f6', 
                    borderRadius: 5 
                }]
            },
            options: { indexAxis: 'y', maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
    </script>
</body>
</html>