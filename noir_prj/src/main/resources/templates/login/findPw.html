<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="title" content="NOIR" />
    <title>Hotel Management - Find Password</title>

    <link rel="stylesheet" type="text/css" th:href="@{/common/css/homepage/base.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/common/css/homepage/style.css(v='0312')}" />
    <link rel="stylesheet" type="text/css" th:href="@{/common/css/homepage/sub.css(v='0312')}" />
    <link rel="stylesheet" type="text/css" th:href="@{/common/css/homepage/admin_style.css}" />

    <script th:src="@{/common/js/comm/jquery-3.5.1.min.js}"></script>
    <script th:src="@{/common/js/comm/jquery.bxslider.js}"></script>
    <script th:src="@{/common/js/homepage/jquery.rwdImageMaps.min.js}"></script>
    <script th:src="@{/common/js/homepage/jquery.accessibility.modal.js}"></script>
    <script th:src="@{/common/js/comm/jquery.cookie.js}"></script>
    <script th:src="@{/common/js/homepage/plugin.js}"></script>
    <script type="text/javascript" th:src="@{/common/js/homepage/jquery.simpleWeather.js}"></script>
    <script th:src="@{/common/js/homepage/custom.js}"></script>

    <style>
        /* 디자인 절대 보존 */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans KR', sans-serif; }
        body {
            background: #0f1218;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('/images/hotel_bg.jpg') no-repeat center center/cover;
            min-height: 100vh; overflow-y: auto; display: flex; flex-direction: column; position: relative;
        }
        header { position: absolute; top: 0; left: 0; width: 100%; z-index: 100; }
        footer { position: relative; width: 100%; z-index: 100; }
        
        /* 중앙 정렬을 위한 래퍼 스타일 */
        #main-wrapper {
            min-height: calc(100vh - 135px); display: flex; justify-content: center; align-items: center;
            width: 100%; position: relative; z-index: 10; padding: 120px 20px 60px 20px; 
        }
        .find-container { width: 100%; max-width: 450px; }
        .find-box {
            background: rgba(44, 41, 38, 0.95); padding: 40px; border-radius: 15px; border: 1px solid #7c6a52;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); color: #fff; text-align: center;
        }
        .find-title { font-size: 24px; font-weight: 700; margin-bottom: 30px; letter-spacing: 2px; color: #C4A16F; }
        .input-group { margin-bottom: 15px; text-align: left; }
        input[type="text"], input[type="password"], input[type="email"], input[type="tel"], input[type="date"] {
            padding: 10px 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid #5a4d3b;
            border-radius: 4px; color: #fff; font-size: 13px; outline: none; transition: 0.3s; width: 100%; height: 42px;
        }
        input:focus { border-color: #C4A16F; background: rgba(196, 161, 111, 0.1); }
        .name-wrapper { display: flex; gap: 8px; }
        .submit-btn { width: 100%; padding: 12px; margin-top: 15px; background: #C4A16F; border: none; border-radius: 4px; color: #fff; font-size: 15px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .submit-btn:hover { background: #7c6a52; }
        .link-group { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 25px; font-size: 13px; }
        .link-group a { color: #D7c4a5; text-decoration: none; transition: 0.3s; }
        .link-group a:hover { color: #C4A16F; }
        #auth-area { display: none; margin-top: 15px; border-top: 1px solid #7c6a52; padding-top: 15px; }
        .btn-small { width: 32%; height: 42px; background: #5a4d3b; border: 1px solid #7c6a52; color: #d7c4a5; border-radius: 4px; cursor: pointer; font-size: 13px; margin-left: 2%; }
        .flex-group { display: flex; justify-content: space-between; }
        .flex-group input { width: 66%; }
    </style>
</head>

<body>
    <header><div th:replace="~{fragments/header :: header}"></div></header>

    <div id="main-wrapper">
        <div class="find-container">
            <div class="find-box">
                <h2 class="find-title">FIND PW</h2>
                <div id="step1">
                    <div class="input-group">
                        <input type="text" id="memberId" placeholder="아이디" required="required" />
                    </div>
                    <div class="input-group">
                        <div class="name-wrapper">
                            <input type="text" id="memberLastName" placeholder="성" required="required" style="width: 35%" />
                            <input type="text" id="memberFirstName" placeholder="이름" required="required" style="width: 65%" />
                        </div>
                    </div>
                    <div class="input-group">
                        <input type="email" id="memberEmail" placeholder="이메일" required="required" />
                    </div>
                    <button type="button" class="submit-btn" id="btnSendCode">인증번호 받기</button>
                    
                    <div id="auth-area">
                        <p style="font-size:13px; color:#C4A16F; margin-bottom:10px;">이메일로 전송된 6자리 코드를 입력하세요.</p>
                        <div class="input-group flex-group">
                            <input type="text" id="authCode" placeholder="인증번호 6자리" maxlength="6" />
                            <button type="button" class="btn-small" id="btnVerify">확인</button>
                        </div>
                    </div>
                </div>
                <div class="link-group">
                    <a th:href="@{/login/memberLogin}">로그인</a><span style="color: #7c6a52;">|</span>
                    <a th:href="@{/login/findId}">아이디 찾기</a><span style="color: #7c6a52;">|</span>
                    <a th:href="@{/join}">회원가입</a>
                </div>
            </div>
        </div>
    </div>

    <footer><div th:replace="~{fragments/footer :: footer}"></div></footer>
    <div id="privacy-layer"><div th:replace="~{fragments/privacy :: privacy}"></div></div>

    <script th:inline="javascript">
    $(document).ready(function(){
        // 1. 인증번호 발송
        $("#btnSendCode").click(function(){
            let data = { 
                memberId: $("#memberId").val(), 
                memberLastName: $("#memberLastName").val(), 
                memberFirstName: $("#memberFirstName").val(), 
                memberEmail: $("#memberEmail").val() 
            };

            if(!data.memberId || !data.memberLastName || !data.memberFirstName || !data.memberEmail) {
                return alert("정보를 모두 입력해주세요.");
            }

            $(this).prop("disabled", true).text("전송 중...");
            
            $.post("/login/sendAuthCode", data, function(res) {
                if(res.trim() === "OK") {
                    alert("인증번호가 발송되었습니다.");
                    $("#auth-area").slideDown();
                } else {
                    alert("일치하는 회원 정보가 없습니다.");
                }
                $("#btnSendCode").prop("disabled", false).text("인증번호 재전송");
            }).fail(function() {
                alert("서버 통신 오류가 발생했습니다.");
                $("#btnSendCode").prop("disabled", false).text("인증번호 받기");
            });
        });
 
        // 2. 인증번호 확인
        $("#btnVerify").click(function(){
            let authCode = $("#authCode").val();
            if(authCode.length < 6) return alert("인증번호 6자리를 입력해주세요.");

            $.post("/login/verifyAuthCode", { authCode: authCode }, function(res) {
                if(res.result === "OK") {
                    alert("인증 성공!");
                    location.href = "/login/resetPw?token=" + res.token;
                } else {
                    alert("인증번호가 일치하지 않습니다.");
                }
            });
        });
    });
    </script>
</body>
</html>